{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "783c0e22_5e33e61e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-14T06:14:52Z",
      "side": 1,
      "message": "I would:\n* Let RabbitMqBrokerApi Inject a Publisher and a Subscriber.\n* Create BrokerApi(Publisher|Subscriber)Provider that handles all loading of properties etc. and bind them to Publish|Subscriber (for clarity you could rename Subscriber BrokerApiSubscriber and create a BrokerApiPublisher interface that Implements Publisher.",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4643b83a_b96f8d1c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-14T11:34:29Z",
      "side": 1,
      "message": "How do I handle closing down the connections if the Publisher and Subscriber is not part of the Manager? Bind the BrokerApiPublisher/Subscriber to the LifecycleListener?",
      "parentUuid": "783c0e22_5e33e61e",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fa99100_0177dfbf",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-15T05:34:53Z",
      "side": 1,
      "message": "Like:\n```\n  @Override\n  public void disconnect() {\n      logger.atFine().log(\"RabbitMqBrokerApi disconnects connections\");\n      publisher.stop();\n      listener.stop();\n    }\n  }\n```",
      "parentUuid": "4643b83a_b96f8d1c",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc0f4e04_dfa1777b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-15T06:51:40Z",
      "side": 1,
      "message": "But what if I do a reload or a remove like \"ssh -p 29418 \u003cgerrit-host\u003e gerrit plugin reload events-rabbitmq\"?",
      "parentUuid": "2fa99100_0177dfbf",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "901b2d3e_f23fe6ef",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-15T07:03:41Z",
      "side": 1,
      "message": "I don\u0027t follow.\nIf events-rabbitmq isn\u0027t responsible for their the life-cycle of the broker API there\u0027s not much we need to do.",
      "parentUuid": "fc0f4e04_dfa1777b",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b3e778d_49479cea",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-25T12:46:29Z",
      "side": 1,
      "message": "I created a BrokerApiPublisher and BrokerApiSubscriber that are Singletons, which both the Manager and RabbitMqBrokerApi has references to.",
      "parentUuid": "901b2d3e_f23fe6ef",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 40,
        "endChar": 74
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f90215ea_8baac7e3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 103,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-14T06:14:52Z",
      "side": 1,
      "message": "This callback to the Manager seems spagettiish.\nWhy not call the stop() methods on the local Subscriber and Publisher?\nThe Manager doesn\u0027t need to get involved at all.",
      "range": {
        "startLine": 103,
        "startChar": 6,
        "endLine": 103,
        "endChar": 33
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a994e1fd_61daade1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 103,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-14T11:34:29Z",
      "side": 1,
      "message": "I did this to make the manager aware that the subscriber and publisher has been closed. So it could do the right thing when the plugin is unloaded(not closing the subscriber and publisher if they had already been closed).",
      "parentUuid": "f90215ea_8baac7e3",
      "range": {
        "startLine": 103,
        "startChar": 6,
        "endLine": 103,
        "endChar": 33
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0ae61df_d1c490df",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 103,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-15T05:34:53Z",
      "side": 1,
      "message": "I don\u0027t think Manager should be involved at all. Just let whoever injects a BrokerApi instance (multi-site, pull-replication, ...) take care of closing the resources.",
      "parentUuid": "a994e1fd_61daade1",
      "range": {
        "startLine": 103,
        "startChar": 6,
        "endLine": 103,
        "endChar": 33
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e68e522_8d8d0608",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 3
      },
      "lineNbr": 103,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-25T12:46:29Z",
      "side": 1,
      "message": "Removed these methods. The Manager and RabbitMqBrokerApi can now close the resources directly with the references to the Singletons BrokerApiPublisher and BrokerApiSubscriber.",
      "parentUuid": "c0ae61df_d1c490df",
      "range": {
        "startLine": 103,
        "startChar": 6,
        "endLine": 103,
        "endChar": 33
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ac33e6b_667a3ded",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/message/MessageSubscriber.java",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-15T05:34:53Z",
      "side": 1,
      "message": "Instead let the Subscriber interface have a #stop() method.\nIt\u0027s not bound to a LifecycleListener, the #start() method is never used and that way you won\u0027t have to class-cast the Subscriber when you want to shut it down.",
      "range": {
        "startLine": 14,
        "startChar": 53,
        "endLine": 14,
        "endChar": 71
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "40a7f22f_999ed592",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/message/MessageSubscriber.java",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-25T12:46:29Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3ac33e6b_667a3ded",
      "range": {
        "startLine": 14,
        "startChar": 53,
        "endLine": 14,
        "endChar": 71
      },
      "revId": "06af8f8b2812bae9f52a7483e2389fb7a26673c8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}