{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d2a50fbc_19d3b763",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "This is a breaking change for those that only use the default config to send gerrit-events to RabbitMQ.\nHow about a config option:\n\n```\n[gerrit]\npublishAllGerritEvents \u003d (Default true)\n```\n\nIf this is set to true you inject the",
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "03c4eb4b_e47491ee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:50:57Z",
      "side": 1,
      "message": "If set to true then setup the default MessagePublisher as before this change?",
      "parentUuid": "d2a50fbc_19d3b763",
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8c018aa1_34bce702",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "Added two new configuration options to control which part of the plugin is enabled. The default states of these options make it so the plugin behave in the same way as before this change.\nI also put these options in a new section called General.",
      "parentUuid": "03c4eb4b_e47491ee",
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "756f2431_c57427be",
        "filename": "README.md",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "Which parts aren\u0027t implemented? This should probably be documented.",
      "range": {
        "startLine": 9,
        "startChar": 28,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7a07e534_08bf0f87",
        "filename": "README.md",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "756f2431_c57427be",
      "range": {
        "startLine": 9,
        "startChar": 28,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c38ff1e6_1bcd0d34",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/Manager.java",
        "patchSetId": 1
      },
      "lineNbr": 76,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "\"publish Gerrit events!\"\nNot many will no what \"the original publisher\" is referring to.\n\nAlso I don\u0027t think this should be a warning, if it should be logged at all it should be at `fine` IMO.\nThe expected behavior is that if you don\u0027t configure a publisher non is started and that\u0027s even less of an anomaly if you can use the plugin as a event-broker.",
      "range": {
        "startLine": 76,
        "startChar": 88,
        "endLine": 76,
        "endChar": 118
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "57281f5c_504be393",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/Manager.java",
        "patchSetId": 1
      },
      "lineNbr": 76,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "I rewrote the code to use flags in the configuration instead of requiring a site config. So this code is removed.",
      "parentUuid": "c38ff1e6_1bcd0d34",
      "range": {
        "startLine": 76,
        "startChar": 88,
        "endLine": 76,
        "endChar": 118
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0c8258c_2af4aad7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/Module.java",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "If broker API is configured?\nIf you are only interested in publishing RabbitMQ messages from Gerrit\u0027s event-bus you don\u0027t want to inject this module that starts a Publisher which starts a publisherthread and creates an unused connection to RabbitMQ.",
      "range": {
        "startLine": 82,
        "startChar": 4,
        "endLine": 82,
        "endChar": 34
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdd4fbd3_fa46256f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/Module.java",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "I added code that prevent connections/threads from being created when the broker is disabled. However, this is done in the RabbitMqBrokerAPI. It is done there because it is a bit cumbersome to do it in the Module classes because the class instances that I need to check the configs are not injected yet.",
      "parentUuid": "c0c8258c_2af4aad7",
      "range": {
        "startLine": 82,
        "startChar": 4,
        "endLine": 82,
        "endChar": 34
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70c431aa_15e16690",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "Don\u0027t we want to handle the RabbitMqBrokerApi and it\u0027s publisher in the Manager to ensure that everything is cleaned up when plugin unloads?",
      "range": {
        "startLine": 35,
        "startChar": 9,
        "endLine": 35,
        "endChar": 26
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "46179ed4_069b6f08",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-01T09:40:23Z",
      "side": 1,
      "message": "The MessagePublisher also implements the LifeCycleListener. So it will clean itself when the plugin unloads.\n\nHowever, the session used to subscribe does not clean itself. I create a new class for subscribing that can implement LifeCycleListener as well.",
      "parentUuid": "70c431aa_15e16690",
      "range": {
        "startLine": 35,
        "startChar": 9,
        "endLine": 35,
        "endChar": 26
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "62abb345_d212cfa6",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-01T10:11:46Z",
      "side": 1,
      "message": "MessagePublisher is not bound to LifecycleListener.class so it\u0027s methods aren\u0027t called when plugin loads/unloads. It is Manager.java that is bound to LifecycleListener and handles the lifecycle of all publishers.\nhttps://gerrit.googlesource.com/plugins/events-rabbitmq/+/9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac/src/main/java/com/googlesource/gerrit/plugins/rabbitmq/Manager.java#80\n\nManager.java is the class that should handle lifecycle for all classes.\nDon\u0027t start the rabbitmq session in the constructor of RabbitMQBrokerAPI, instead expose the #start #stop method of the session and let Manager create the RabbitMQBrokerAPI instance and start and stop it when the plugin loads/unloads.",
      "parentUuid": "46179ed4_069b6f08",
      "range": {
        "startLine": 35,
        "startChar": 9,
        "endLine": 35,
        "endChar": 26
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8619f941_01cb2138",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-09-01T13:47:33Z",
      "side": 1,
      "message": "From F2F. I was confused regarding who has an instance of the RabbitMQBrokerAPI.\nIt\u0027s the other plugin, e.g. multi-site, that is responsible for calling #disconnect() (which it currently doesn\u0027t).",
      "parentUuid": "62abb345_d212cfa6",
      "range": {
        "startLine": 35,
        "startChar": 9,
        "endLine": 35,
        "endChar": 26
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b5f060d_f8d1f72c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "I created a new class Subscriber and made the Manager create a instance of the publisher and subscriber that the RabbitMQBrokerAPI can use. Now the manager will close those connections also if the plugin unloads.",
      "parentUuid": "8619f941_01cb2138",
      "range": {
        "startLine": 35,
        "startChar": 9,
        "endLine": 35,
        "endChar": 26
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "707338d9_7108eb50",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-08-31T12:49:40Z",
      "side": 1,
      "message": "What happens if this file doesn\u0027t exist?",
      "range": {
        "startLine": 56,
        "startChar": 38,
        "endLine": 56,
        "endChar": 84
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e8964366_0778e4e6",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/rabbitmq/RabbitMqBrokerApi.java",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2023-09-08T14:03:21Z",
      "side": 1,
      "message": "It logs that the file is missing and just use the default values. I have rewritten this to use just the base config instead if the file is missing.",
      "parentUuid": "707338d9_7108eb50",
      "range": {
        "startLine": 56,
        "startChar": 38,
        "endLine": 56,
        "endChar": 84
      },
      "revId": "9a0bc9c9d11aa67f243a404a8579dcfd5e3ab0ac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}